{% load humanize %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Message</title>
        <link rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
            integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
            crossorigin="anonymous">
    </head>
    <style>
        .profile_dp{
height:3em;
margin-top: -0.5em;
margin-bottom: -0.5em;
border-radius: 200px 200px 200px 200px;
-moz-border-radius: 200px 200px 200px 200px;
-webkit-border-radius: 200px 200px 200px 200px;
border: 1.5px solid #000000;

}




/* button dots */
.test:after {
  content: '\2807';
  font-size: 30px;
  }


/* snap */

    </style>
    <body >



        <!--navbar start-->
        <nav style="border-radius: 0px 0px 10px 10px;
            -moz-border-radius: 0px 0px 10px 10px;
            -webkit-border-radius: 0px 0px 10px 10px;
            border: 0.5px solid #d0f7fe; " class="navbar fixed-top
            navbar-expand-lg
            navbar-light bg-light">


            <a class="navbar-brand mr-auto" href="/userpage"><img style="height:
                    4.2em;
                    margin-bottom: -1.2em;
                    margin-top: -1.2em; margin-left:-1em;"
                    src="https://i.imgur.com/t81Henw.png" alt="">
            </a>

            <div style="margin-bottom: -1em;" class="navbar-brand mx-auto">
                <a style="margin-right: .4rem;" class="navbar-brand" href="{%
                    url 'userprofile' userchat %}">

                    <img style="height: 3em;
                        margin-bottom: .3em;" class="profile_dp"
                        src="{{ profile.userImage.url }}"
                        alt="">


                </div>


                <div class="dropleft ml-auto">
                    <a class="test" style="text-decoration: none;" href="#"
                        role="button" id="dropdownMenuLink"
                        data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">

                    </a>

                    <div class="dropdown-menu"
                        aria-labelledby="dropdownMenuLink">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </div>









            </nav>
            <!--navbarend-->







            <!--spinner-->
            <div style="padding-bottom: 30vh; margin-top: 20vh;  overflow:hidden;display: flex;
            flex-direction: column-reverse; "   id="chatcontent">

                
                

                
               

                {% for msg in msgs  %}
                
                  
                
                {% if msg.text|length > 0 %}
                {% if msg.chatter == request.user.username %}
                <div style="width: 50vw;
                    margin-top: 1em;
                    border-radius: 15px 15px 15px 15px;

                    margin-left: 49vw;    " class="alert alert-success"
                    role="alert">
                    {% else %}
                    <div style="width: 50vw;
                    margin-top: 1em;
                    border-radius: 15px 15px 15px 15px;
                    margin-right: 49vw;" class="alert
                    alert-primary" role="alert">

                    {% endif %}
                      
                    
                   <p style="word-wrap: break-word; font-weight: bold;"> {{msg.text}} <small class="text-muted"> {{msg.time|naturaltime}}</small> </p>
                   
                    
                </div>
                {% endif %}
                
                {% endfor %}
                

            </div>
            <!--nav bottom-->
            <nav style="border-radius: 10px 10px 0px 0px;
                -moz-border-radius: 10px 10px 0px 0px;
                -webkit-border-radius: 10px 10px 0px 0px;
                border: 0.5px solid #d0f7fe; height: 4em;  " class="navbar
                fixed-bottom
                navbar-light
                bg-light">
                <div class="navbar-nav mr-auto">

                </div>

                <div style="margin-top: -1em;" class="navbar-nav mx-auto">
                    <form method="POST" id ="chat" action="{% url 'talk' profile.user %}" class="form-inline my-2 my-lg-0">
                        {% csrf_token %}
                        <input style="width: auto; min-width: 60vw;"
                            class="form-control mr-sm-2" type="text" name="messages1"
                            placeholder="Type..." aria-label="Search" autocomplete="off">
                            <input 
                            class="form-control mr-sm-2" type="hidden" name="chatter"
                            value="{{request.user.username}}"
                             >
                        <button style="width:2em;" class="navbar-brand btn
                            btn-outline-primary btn-sm my-2 my-sm-0"
                            type="submit"><svg width="1em" height="1em"
                                viewBox="0 0
                                16 16" class="bi bi-chat-square-quote-fill"
                                fill="currentColor"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M0 2a2 2 0 0 1
                                    2-2h12a2
                                    2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.5a1 1 0 0
                                    0-.8.4l-1.9 2.533a1 1 0 0 1-1.6 0L5.3 12.4a1
                                    1 0
                                    0 0-.8-.4H2a2 2 0 0 1-2-2V2zm7.194
                                    2.766c.087.124.163.26.227.401.428.948.393
                                    2.377-.942 3.706a.446.446 0 0
                                    1-.612.01.405.405
                                    0 0
                                    1-.011-.59c.419-.416.672-.831.809-1.22-.269.165-.588.26-.93.26C4.775
                                    7.333 4 6.587 4 5.667 4 4.747 4.776 4 5.734
                                    4c.271 0
                                    .528.06.756.166l.008.004c.169.07.327.182.469.324.085.083.161.174.227.272zM11
                                    7.073c-.269.165-.588.26-.93.26-.958
                                    0-1.735-.746-1.735-1.666 0-.92.777-1.667
                                    1.734-1.667.271 0
                                    .528.06.756.166l.008.004c.17.07.327.182.469.324.085.083.161.174.227.272.087.124.164.26.228.401.428.948.392
                                    2.377-.942 3.706a.446.446 0 0
                                    1-.613.01.405.405
                                    0 0 1-.011-.59c.42-.416.672-.831.81-1.22z"
                                    />
                                </svg></button>
                        </form>

                    </div>



                    <div class="navbar-nav ml-auto">

                    </div>


                </nav>

            </body>
            <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>

            
            

            
            <script type="text/javascript">
                $(document).ready(function() {
                    $('#chat').submit(function() {
                        var out = document.getElementById("chatcontent"); // On form submit event
                        $.ajax({ // create an AJAX call...
                            data: $(this).serialize(), // get the form data
                            type: $(this).attr('method'), // GET or POST
                            url: $(this).attr('action'), // the file to call
                            success: function(response) { // on success..
                                console.log('success')
                               $('body').load('{% url 'talk' userchat  %}'); 
                               $('#everything').html(response); 
                               
                               
                               
                               // window.scrollTo(0,document.querySelector('#chatcontent').scrollHeight-30);
                            },
                            error: function(e, x, r) { // on error..
                                console.log('error');
                                $('body').load('{% url 'talk' userchat  %}'); // update the DIV
                            }
                            
                        });
                        return false;
                    });
                });
                </script>
                <script>
                    function alertFunc() {
                        $('#chatcontent').load('{% url 'talk' userchat  %}');
                        //console.log('refresh');
                        
                       
                      //Make sure message list is scrolled to the bottom
                     // var objDiv = document.body;
                     //objDiv.scrollTop = objDiv.scrollHeight;
                     
                     


                     }
                     setTimeout(alertFunc, 4000);
                     

                     



                     window.onload = function(){
              window.scrollTo(0, document.getElementById('chatcontent').scrollHeight);
                  }
                </script>









        </html>